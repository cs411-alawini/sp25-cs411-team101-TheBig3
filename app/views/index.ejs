<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>
    <%= title %>
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/stylesheets/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">


</head>

<body>
  <header>
    <a href="/" class="title">Odyssey</a>

    <div class="right-side">
      <nav class="nav-links">
        <a href="/browse">Browse</a>
        <a href="/explore">Explore</a>
        <a href="/log">Log</a>
        <a href="/profile">Profile</a>
      </nav>

      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search vacation spots, cities..." />
        <div id="search-dropdown" class="dropdown"></div>
      </div>
    </div>
  </header>

  <!-- <section class="hero">
    <h1 class="hero-title">Travel</h1>
    <p class="hero-subtitle">Where will your adventure take you?</p>
  </section> -->
  <section class="hero">
    <div class="hero-overlay">
      <h1 class="hero-title">Travel the World</h1>
      <p class="hero-subtitle">Where will your adventure take you?</p>
      <a href="/explore" class="hero-button">Start Exploring</a>
    </div>
  </section>


  <footer class="site-footer">
    <p>CS 411 Database Systems Project â€” Last updated April 2025</p>
    <p><a href="https://github.com/cs411-alawini/sp25-cs411-team101-TheBig3" target="_blank">View our GitHub
        Repository</a></p>
  </footer>
  <script>
    let searchTimeout = null;

    document.getElementById("search-input").addEventListener("input", function () {
      clearTimeout(searchTimeout);
      const keyword = this.value.trim();

      const dropdown = document.getElementById("search-dropdown");
      dropdown.innerHTML = '';

      if (!keyword) {
        dropdown.style.display = 'none';
        return;
      }

      searchTimeout = setTimeout(() => {
        fetch(`/search?keyword=${encodeURIComponent(keyword)}`)
          .then(response => response.json())
          .then(data => {
            const results = data.searchResults;
            console.log('Search results:', results);

            if (!results.length) {
              dropdown.style.display = 'none';
              return;
            }

            //STILL NEED TO WORK ON WHEN CLICK WILL REDIRECT TO MAP LOCATION WITH REVIEWS
            //ALSO NEED AN INFO TAB FOR EACH VACATIO NWHEN CLICKED ON WHICH WILL SHOW INFO ON THAT CITY/VACATION

            const itemsHTML = results.map(item =>
              `<div class="dropdown-item"
    data-cityid="${item.CityID}"
    data-spotname="${item.VacationSpotName}">
    ${item.VacationSpotName}
  </div>`
            ).join('');


            dropdown.innerHTML = itemsHTML;
            dropdown.style.display = 'block';

            document.querySelectorAll('.dropdown-item').forEach(item => {
              item.addEventListener('click', async function () {
                const cityId = this.getAttribute('data-cityid');
                const vacationSpotName = this.getAttribute('data-spotname');

                console.log('Clicked Vacation Spot Info:', {
                  CityID: cityId,
                  VacationSpotName: vacationSpotName
                });

                try {
                  const response = await fetch(`/getLocation?cityId=${cityId}`);
                  if (!response.ok) {
                    const error = await response.json();
                    console.error('Failed to get location:', error);
                    return;
                  }
                  const locationData = await response.json();

                  console.log('Fetched Location Data:', locationData);

                  if (locationData.lat && locationData.lng) {
                    console.log('Redirecting to explore...');
                    // window.location.href = `/explore?lat=${locationData.lat}&lng=${locationData.lng}`;
                  } else {
                    alert('Location data not found.');
                  }
                } catch (error) {
                  console.error('Error fetching location:', error);
                  alert('Failed to load location.');
                }
              });
            });


          })
          .catch(err => {
            console.error('Failed to search vacation spots:', err);
            dropdown.style.display = 'none';
          });
      }, 400);
    });


  </script>




</body>

</html>