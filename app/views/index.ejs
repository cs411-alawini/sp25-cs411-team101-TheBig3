<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title><%= title %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/stylesheets/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href='https://api.mapbox.com/mapbox-gl-js/v3.11.0/mapbox-gl.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox-gl-js/v3.11.0/mapbox-gl.js'></script>
  
</head>
<body>
  <header>
    <div class="title">Odyssey</div>
  
    <div class="right-side">
      <div class="explore">Explore</div>
      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search vacation spots, cities..." />
        <div id="search-dropdown" class="dropdown"></div>
      </div>
    </div>
  </header>
  

  <section class="hero">
    <h1 class="hero-title">Journey</h1>
    <p class="hero-subtitle">Where does your adventure take you?</p>
  </section>
  

  <!-- <div style="text-align: center; width: 100%;">
    <button id="crud-button">CRUD Retrieval</button>
  </div> -->

  <div class="map-container">
    <div id = "map"></div>
  </div>

  <div id="crud-table-container" style="width: 90%; margin: 1rem auto;"></div>

  <script>

    mapboxgl.accessToken = 'pk.eyJ1Ijoicmlja3lsaW4xIiwiYSI6ImNtOXlqa2NteTFrdWMya3ByZW5taGw3NjAifQ.PlPUQnzvMMZkKQP1GTPyBQ';
    const map = new mapboxgl.Map({
      container: 'map', // container ID
      style: 'mapbox://styles/mapbox/streets-v12', // style URL
      center: [-74.5, 40], // starting position [lng, lat]
      zoom: 9, // starting zoom
    });

    let searchTimeout = null;
  
    // document.getElementById("search-input").addEventListener("input", function () {
    //   clearTimeout(searchTimeout); // clear previous timer
    //   const keyword = this.value.trim();
  
    //   if (!keyword) {
    //     document.getElementById("crud-table-container").innerHTML = '';
    //     return;
    //   }
  
    //   searchTimeout = setTimeout(() => {
    //     fetch(`/search?keyword=${encodeURIComponent(keyword)}`)
    //       .then(response => response.json())
    //       .then(data => {
    //         const results = data.searchResults;

    //         console.log('results is', results)
            
    //         if (!results.length) {
    //           document.getElementById("crud-table-container").innerHTML = '<p>No matching vacation spots found.</p>';
    //           return;
    //         }
  
    //         const columns = Object.keys(results[0]);
    //         const headerRow = columns.map(col => `<th>${col}</th>`).join('');
    //         const bodyRows = results.map(item => `
    //           <tr>
    //             ${columns.map(col => `<td>${item[col]}</td>`).join('')}
    //           </tr>
    //         `).join('');
  
    //         const tableHTML = `
    //           <table>
    //             <thead>
    //               <tr>${headerRow}</tr>
    //             </thead>
    //             <tbody>
    //               ${bodyRows}
    //             </tbody>
    //           </table>
    //         `;
  
    //         document.getElementById("crud-table-container").innerHTML = tableHTML;
    //       })
    //       .catch(err => {
    //         console.error("Failed to perform search:", err);
    //         document.getElementById("crud-table-container").innerHTML = '<p>Error during search.</p>';
    //       });
    //   }, 400); // <-- 400 milliseconds after user stops typing
    // });
    document.querySelector(".explore").addEventListener("click", function () {
      document.querySelector(".map-container").scrollIntoView({ behavior: "smooth", block: "start"});
  });


    document.getElementById("search-input").addEventListener("input", function () {
  clearTimeout(searchTimeout);
  const keyword = this.value.trim();

  const dropdown = document.getElementById("search-dropdown");
  dropdown.innerHTML = ''; // clear previous dropdown items

  if (!keyword) {
    dropdown.style.display = 'none';
    return;
  }

  searchTimeout = setTimeout(() => {
    fetch(`/search?keyword=${encodeURIComponent(keyword)}`)
      .then(response => response.json())
      .then(data => {
        const results = data.searchResults;
        console.log(results)

        if (!results.length) {
          dropdown.style.display = 'none';
          return;
        }

        const itemsHTML = results.map(item => 
          `<div class="dropdown-item">${item.VacationSpotName}</div>` // or whatever field you want to display
        ).join('');

        dropdown.innerHTML = itemsHTML;
        dropdown.style.display = 'block';
      })
      .catch(err => {
        console.error("Failed to perform search:", err);
        dropdown.style.display = 'none';
      });
  }, 400);
});
  

    // document.getElementById("crud-button").addEventListener("click", function () {
    //   fetch('/users/top10')
    //     .then(response => response.json())
    //     .then(data => {
    //       const users = data.users;
      
    //       if (!users.length) {
    //         document.getElementById("crud-table-container").innerHTML = '<p>No users found.</p>';
    //         return;
    //       }
      
    //       const columns = Object.keys(users[0]);
    //       const headerRow = columns.map(col => `<th>${col}</th>`).join('');
    //       const bodyRows = users.map(user => `
    //         <tr>
    //           ${columns.map(col => `<td>${user[col]}</td>`).join('')}
    //         </tr>
    //       `).join('');
      
    //       const tableHTML = `
    //         <table>
    //           <thead>
    //             <tr>${headerRow}</tr>
    //           </thead>
    //           <tbody>
    //             ${bodyRows}
    //           </tbody>
    //         </table>
    //       `;
      
    //       document.getElementById("crud-table-container").innerHTML = tableHTML;
    //     })
    //     .catch(err => {
    //       console.error("Failed to fetch user data:", err);
    //       document.getElementById("crud-table-container").innerHTML = '<p>Error loading users.</p>';
    //     });
    // });
  </script>
  

</body>
</html>
